{% assign img_path = include.path | remove: '.jpg' | remove: '.jpeg' | remove: '.png' | remove: '.tiff' | remove: '.gif' %}

<figure
  {% if include.slot %}
    slot="{{ include.slot }}"
  {% endif %}
>
  <picture>
    <!-- Auto scaling with imagemagick -->
    <!--
      See https://www.debugbear.com/blog/responsive-images#w-descriptors-and-the-sizes-attribute and
      https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images for info on defining 'sizes' for responsive images
    -->
    {% if site.imagemagick.enabled %}
      <source
        class="responsive-img-srcset"
        srcset="{% for i in site.imagemagick.widths %}{{ img_path | relative_url }}-{{ i }}.webp {{i}}w,{% endfor %}"
        {% if include.sizes %}
          sizes="{{include.sizes}}"
        {% else %}
          sizes="95vw"
        {% endif %}
        type="image/webp"
      >
    {% endif %}
    <embed
      {% if include.src %}
        src="{{ include.src }}"
      {% else %}
      {% if include.type %}
        type="{{ include.type }}"
      {% else %}
      {% if include.width %}
        width="{{ include.width }}"
      {% endif %}
      {% if include.height %}
        height="{{ include.height }}"
      {% else %}
    >
  </picture>

  {% if include.caption %}
    <figcaption class="caption">{{ include.caption }}</figcaption>
  {% endif %}
</figure>
